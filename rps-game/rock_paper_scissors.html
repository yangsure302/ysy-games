<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”¥ YSYå’Œå¥¹çš„å¥½æœ‹å‹ä»¬çš„çŸ³å¤´å‰ªåˆ€å¸ƒç‹è€…å¯¹å†³ ğŸ”¥</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            width: 100%;
            background: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column; 
            gap: 30px;
        }
        
        .main-header {
            text-align: center;
            color: #FF5722; 
            border-bottom: 3px solid #FF5722;
            padding-bottom: 20px;
            margin-bottom: 30px;
            font-size: 2.5em; 
            font-weight: 800;
            letter-spacing: 1px;
        }

        h3 {
            color: #2196F3;
            margin-top: 25px;
            border-left: 6px solid #2196F3;
            padding-left: 12px;
            font-size: 1.5em;
        }
        .section {
            background: #fafafa;
            padding: 20px;
            border-radius: 10px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .content-area {
            display: flex;
            gap: 30px;
            width: 100%;
        }

        .player-control-section {
            flex: 0 0 300px; 
        }
        .right-panel {
            flex: 1; 
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .game-area {
            display: flex;
            gap: 20px;
        }
        .game-controls, .game-results {
            flex: 1;
            border: 1px solid #e0e0e0;
            padding: 20px;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .ranking-panel {
            width: 100%;
            display: flex;
            gap: 20px;
        }
        .rank-column {
            flex: 1;
            border: 1px solid #e0e0e0;
            padding: 20px;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        input[type="text"] {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: calc(100% - 22px);
            margin-bottom: 10px;
            font-size: 1em;
        }
        button {
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s ease, transform 0.1s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover { transform: translateY(-1px); }
        #add-player-btn { background-color: #FF9800; color: white; }
        #add-player-btn:hover { background-color: #fb8c00; }
        #clear-players-btn { background-color: #f44336; color: white; }
        #clear-players-btn:hover { background-color: #e53935; }
        #players-list label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 1.1em;
            cursor: pointer;
            padding: 8px 10px;
            background-color: #e8f5e9;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        #players-list label:hover { background-color: #dcedc8; }
        #players-list button { margin: 0; }
        #players-list .player-score { font-size: 0.9em; color: #555; }
        
        #active-players-selection label {
            display: inline-block;
            margin-right: 10px;
            margin-bottom: 8px;
            padding: 8px 10px;
            background-color: #e0f2f7;
            border-radius: 5px;
            cursor: pointer;
        }
        #active-players-selection input[type="checkbox"] {
            margin-right: 5px;
            transform: scale(1.1);
            vertical-align: middle;
        }
        #play-btn {
            background-color: #4CAF50;
            color: white;
            font-size: 1.3em;
            padding: 15px 30px;
            width: calc(100% - 20px);
            margin-top: 15px;
            margin-right: 0;
        }
        #play-btn:hover { background-color: #43A047; }
        .round-result {
            border-bottom: 1px dashed #eee;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        .player-move { font-size: 1.1em; margin-bottom: 5px; }
        .winner { color: #4CAF50; font-weight: bold; }
        .loser { color: #f44336; font-weight: bold; }
        .draw { color: #FFC107; font-weight: bold; }
        .emoji-big {
            font-size: 1.8em;
            vertical-align: middle;
            margin-left: 5px;
        }
        .ranking-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dotted #e0e0e0;
            font-size: 1.1em;
        }
        .rank-title {
            font-weight: bold;
            font-size: 1.2em;
            color: #2196F3;
            margin-top: 0;
            margin-bottom: 10px;
            text-align: center;
            background-color: #e8f5e9;
            padding: 10px;
            border-radius: 5px;
        }
        .rank-name { color: #3f51b5; }
        .rank-score { font-weight: bold; }
        .no-players-message, .no-rank-message {
            color: #777;
            font-style: italic;
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="container">
    
    <h2 class="main-header">ğŸ”¥ YSYå’Œå¥¹çš„å¥½æœ‹å‹ä»¬çš„çŸ³å¤´å‰ªåˆ€å¸ƒç‹è€…å¯¹å†³ ğŸ”¥</h2>

    <div class="content-area">
        <div class="player-control-section">
            <div class="section">
                <h3>ğŸ‘¥ ç©å®¶ç®¡ç†</h3>
                <input type="text" id="player-name-input" placeholder="è¾“å…¥ç©å®¶å§“å">
                <button id="add-player-btn" onclick="addPlayer()">æ·»åŠ ç©å®¶</button>
                <button id="clear-players-btn" onclick="clearAllPlayers()">æ¸…ç©ºæ‰€æœ‰ç©å®¶</button>
                <div id="players-list" style="margin-top: 15px;">
                    <p class="no-players-message">è¯·æ·»åŠ ç©å®¶</p>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="game-area">
                <div class="game-controls">
                    <h3>ğŸ•¹ï¸ æ¸¸æˆæ§åˆ¶</h3>
                    <p style="color: #555;">å‹¾é€‰è¦å‚ä¸æœ¬å±€å¯¹å†³çš„ç©å®¶ï¼š</p>
                    <div id="active-players-selection">
                        <p class="no-players-message">è¯·å…ˆæ·»åŠ ç©å®¶</p>
                    </div>
                    <button id="play-btn" onclick="playRound()">çŸ³å¤´å‰ªåˆ€å¸ƒï¼</button>
                </div>

                <div class="game-results">
                    <h3>ğŸ“ å¯¹å†³ç»“æœ</h3>
                    <div id="current-round-result">
                        <p class="no-players-message">ç‚¹å‡»â€œçŸ³å¤´å‰ªåˆ€å¸ƒï¼â€å¼€å§‹å¯¹å†³</p>
                    </div>
                </div>
            </div>

            <div class="ranking-panel">
                <div class="rank-column">
                    <div class="rank-title">ğŸ¥‡ æ€»ç‹è€…æ¦œ (èƒœåœºæœ€å¤š)</div>
                    <div id="winner-ranking">
                        <p class="no-rank-message">æš‚æ— æ’å</p>
                    </div>
                </div>
                <div class="rank-column">
                    <div class="rank-title">ğŸ¤¡ æ€»å†¤ç§æ¦œ (è´¥åœºæœ€å¤š)</div>
                    <div id="loser-ranking">
                        <p class="no-rank-message">æš‚æ— æ’å</p>
                    </div>
                </div>
                 <div class="rank-column">
                    <div class="rank-title">ğŸ”¥ è¿èƒœç‹ (è¿ç»­èƒœåœº)</div>
                    <div id="streak-winner-ranking">
                        <p class="no-rank-message">æš‚æ— æ’å</p>
                    </div>
                </div>
                <div class="rank-column">
                    <div class="rank-title">ğŸ¥¶ è¿è´¥ç‹ (è¿ç»­è´¥åœº)</div>
                    <div id="streak-loser-ranking">
                        <p class="no-rank-message">æš‚æ— æ’å</p>
                    </div>
                </div>
            </div>
            
            <div class="game-history section">
                <h3>ğŸ“œ å›åˆè®°å½• (æœ€è¿‘ 5 å±€)</h3>
                <div id="round-history">
                    <p class="no-players-message">æ— å†å²è®°å½•</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const MOVES = {
        ROCK: { name: 'çŸ³å¤´', emoji: 'ğŸª¨' },
        PAPER: { name: 'å¸ƒ', emoji: 'ğŸ“„' },
        SCISSORS: { name: 'å‰ªåˆ€', emoji: 'âœ‚ï¸' }
    };
    
    const playerScores = {}; 
    let allPlayerNames = [];
    let roundHistory = []; 

    // --- ç©å®¶ç®¡ç† ---
    function addPlayer() {
        const input = document.getElementById('player-name-input');
        let playerName = input.value.trim();

        if (!playerName || allPlayerNames.includes(playerName)) {
            alert(playerName ? 'è¯¥ç©å®¶å·²å­˜åœ¨ï¼' : 'è¯·è¾“å…¥ç©å®¶å§“åï¼');
            return;
        }

        allPlayerNames.push(playerName);
        playerScores[playerName] = { wins: 0, losses: 0, draws: 0, winStreak: 0, loseStreak: 0, totalGames: 0 };
        input.value = '';
        
        updatePlayersList();
        updateActivePlayersSelection();
        updateRankings();
    }

    function removePlayer(nameToRemove) {
        allPlayerNames = allPlayerNames.filter(name => name !== nameToRemove);
        delete playerScores[nameToRemove];
        updatePlayersList();
        updateActivePlayersSelection();
        updateRankings();
    }
    
    function clearAllPlayers() {
        if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç©å®¶ã€åˆ†æ•°å’Œå†å²è®°å½•å—ï¼Ÿ')) {
            allPlayerNames = [];
            roundHistory = [];
            for (const key in playerScores) { delete playerScores[key]; }
            updatePlayersList();
            updateActivePlayersSelection();
            updateRankings();
            updateRoundHistory();
            document.getElementById('current-round-result').innerHTML = '<p class="no-players-message">ç‚¹å‡»â€œçŸ³å¤´å‰ªåˆ€å¸ƒï¼â€å¼€å§‹å¯¹å†³</p>';
        }
    }

    function updatePlayersList() {
        const listDiv = document.getElementById('players-list');
        if (allPlayerNames.length === 0) {
            listDiv.innerHTML = '<p class="no-players-message">è¯·æ·»åŠ ç©å®¶</p>';
            return;
        }
        listDiv.innerHTML = allPlayerNames.map(name => `
            <label>
                <span>${name}</span>
                <span class="player-score">W:${playerScores[name].wins} L:${playerScores[name].losses}</span>
                <button onclick="event.stopPropagation(); removePlayer('${name}')">åˆ é™¤</button>
            </label>
        `).join('');
    }

    function updateActivePlayersSelection() {
        const selectionDiv = document.getElementById('active-players-selection');
        if (allPlayerNames.length === 0) {
            selectionDiv.innerHTML = '<p class="no-players-message">è¯·å…ˆæ·»åŠ ç©å®¶</p>';
            return;
        }
        selectionDiv.innerHTML = allPlayerNames.map(name => `
            <label style="background-color: #e0f2f7; color: #01579B;">
                <input type="checkbox" value="${name}" checked> ${name}
            </label>
        `).join('');
    }

    // --- æ¸¸æˆé€»è¾‘ ---
    function getRandomMove() {
        const moves = Object.values(MOVES);
        const randomIndex = Math.floor(Math.random() * moves.length);
        return moves[randomIndex];
    }

    function getResult(move1, move2) {
        if (move1 === move2) return 'draw';
        if (
            (move1 === MOVES.ROCK && move2 === MOVES.SCISSORS) ||
            (move1 === MOVES.PAPER && move2 === MOVES.ROCK) ||
            (move1 === MOVES.SCISSORS && move2 === MOVES.PAPER)
        ) {
            return 'win';
        }
        return 'lose';
    }

    function playRound() {
        const activeCheckboxes = document.querySelectorAll('#active-players-selection input[type="checkbox"]:checked');
        if (activeCheckboxes.length < 2) {
            alert('è¯·è‡³å°‘é€‰æ‹©ä¸¤ä½ç©å®¶è¿›è¡Œå¯¹å†³ï¼');
            return;
        }

        const players = Array.from(activeCheckboxes).map(cb => cb.value); 
        const playerMoves = {};
        const outcome = { winner: [], loser: [], draw: [] }; 
        
        let allMoves = [];
        players.forEach(name => {
            playerMoves[name] = getRandomMove();
            allMoves.push(playerMoves[name]);
        });
        
        const movesSet = new Set(allMoves.map(m => m.name));
        
        // åˆ¤æ–­å½“å±€ç»“æœ
        if (movesSet.size === 1 || movesSet.size === 3) {
            // åªæœ‰ä¸€ç§æ‹³ï¼ˆå¹³å±€ï¼‰æˆ–ä¸‰ç§æ‹³ï¼ˆå¤§å¹³å±€ï¼‰
            outcome.draw = players;
        } else {
            // åªæœ‰ä¸¤ç§æ‹³ï¼Œå­˜åœ¨èƒœè´Ÿæ–¹
            const movesArr = Array.from(movesSet); 
            
            // â­ï¸ æœ€ç»ˆä¿®å¤ï¼šå¼ºåˆ¶ç¡®å®š winningMoveï¼Œä¸å†ä¾èµ– movesArr çš„é¡ºåº
            let winningMoveName;
            
            // å‡è®¾ movesArr åªæœ‰ä¸¤ç§æ‹³ï¼Œæˆ‘ä»¬å¼ºåˆ¶æ£€æŸ¥å“ªç§æ˜¯èµ¢å®¶
            const moveName1 = movesArr[0];
            const moveName2 = movesArr[1];
            
            // æ‰¾åˆ° MOVE å¯¹è±¡
            const move1 = Object.values(MOVES).find(m => m.name === moveName1);
            const move2 = Object.values(MOVES).find(m => m.name === moveName2);

            if (getResult(move1, move2) === 'win') {
                winningMoveName = moveName1;
            } else {
                winningMoveName = moveName2;
            }
            const losingMoveName = movesArr.find(name => name !== winningMoveName);


            // ç¡®å®šèƒœè´Ÿç©å®¶
            players.forEach(name => {
                const move = playerMoves[name];
                if (move.name === winningMoveName) {
                    outcome.winner.push(name);
                } else if (move.name === losingMoveName) {
                    outcome.loser.push(name);
                }
            });
        }
        
        // æ›´æ–°åˆ†æ•°å’Œè¿èƒœ/è¿è´¥è®°å½•
        players.forEach(name => {
            let score = playerScores[name];
            score.totalGames++;

            if (outcome.winner.includes(name)) {
                score.wins++;
                score.winStreak++;
                score.loseStreak = 0;
            } else if (outcome.loser.includes(name)) {
                score.losses++;
                score.loseStreak++;
                score.winStreak = 0;
            } else if (outcome.draw.includes(name)) {
                score.draws++;
                score.winStreak = 0;
                score.loseStreak = 0;
            }
        });
        
        // æ˜¾ç¤ºç»“æœ
        displayRoundResult(playerMoves, outcome, players.length);
        
        // æ›´æ–°å†å²è®°å½•å’Œæ’å
        roundHistory.unshift({ round: roundHistory.length + 1, playerMoves: playerMoves, outcome: outcome, timestamp: new Date().toLocaleTimeString() });
        if (roundHistory.length > 5) roundHistory.pop(); 
        
        updateRoundHistory();
        updatePlayersList(); 
        updateRankings();
    }

    function displayRoundResult(playerMoves, outcome, playerCount) {
        const resultDiv = document.getElementById('current-round-result');
        let html = `<h4>å›åˆç»“æœ (${new Date().toLocaleTimeString()})</h4>`;
        
        html += '<p
