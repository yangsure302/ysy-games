<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¸ ç¤¾å›¢ç¾½æ¯›çƒèµ› - è‡ªåŠ¨ç»„é˜Ÿä¸æ’åºå·¥å…·</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
        }
        .container {
            max-width: 1400px; /* å¢åŠ æœ€å¤§å®½åº¦ä»¥é€‚åº”åŒæ  */
            margin: auto;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h2 {
            text-align: center;
            color: #007bff;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        h3 {
            color: #28a745;
            margin-top: 30px;
            border-left: 5px solid #28a745;
            padding-left: 10px;
        }
        
        /* æ ¸å¿ƒåˆ†æ å¸ƒå±€ */
        .main-content {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .input-area {
            flex: 0 0 350px; /* å·¦ä¾§è¾“å…¥æ å›ºå®šå®½åº¦ */
        }
        .output-area {
            flex: 1; /* å³ä¾§è¾“å‡ºåŒºåŸŸå æ®å‰©ä½™ç©ºé—´ */
            display: flex;
            gap: 20px;
        }
        .column {
            flex: 1; /* ä¸¤ä¸ªç»“æœåŒºåŸŸå¹³åˆ†å³ä¾§ç©ºé—´ */
            min-width: 300px;
        }
        /* --------------------- */
        
        .input-group, .controls {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        .controls button {
            width: 100%;
            padding: 10px 0;
            font-size: 16px;
            margin-bottom: 10px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        #draw-btn {
            background-color: #007bff;
            color: white;
        }
        #draw-btn:hover { background-color: #0056b3; }
        #fixture-btn {
            background-color: #28a745;
            color: white;
        }
        #fixture-btn:hover { background-color: #1e7e34; }
        .participant-row {
            display: flex;
            gap: 5px;
            align-items: center;
            margin-bottom: 10px;
            padding: 5px 0;
            border-bottom: 1px dashed #eee;
            flex-wrap: wrap;
        }
        .participant-row input[type="text"], .participant-row select {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .participant-row .name-input { width: 80px; }
        .participant-row .gender-select { width: 50px; }
        .participant-row .checkbox-group { 
            display: flex;
            flex-direction: column;
            line-height: 1.2;
            font-size: 0.9em;
            flex-grow: 1;
        }
        .participant-row button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
        }
        .participant-row button:hover { background-color: #c82333; }
        .add-btn {
            background-color: #ffc107;
            color: #333;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }
        .add-btn:hover { background-color: #e0a800; }

        /* ç»“æœæ ·å¼ */
        .result-section {
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            margin-top: 15px;
            min-height: 400px; /* ç¡®ä¿ç»“æœåŒºåŸŸé«˜åº¦ä¸€è‡´ */
        }
        .team-list {
            list-style: none;
            padding: 0;
        }
        .team-item {
            background: #e9ecef;
            margin-bottom: 8px;
            padding: 10px;
            border-radius: 4px;
            font-size: 1em;
        }
        .fixture-item {
            background: #d4edda;
            margin-bottom: 10px;
            padding: 12px;
            border-radius: 6px;
            font-weight: bold;
            color: #155724;
            display: flex;
            justify-content: space-between;
            font-size: 0.95em;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ¸ ç¤¾å›¢ç¾½æ¯›çƒèµ› - è‡ªåŠ¨ç»„é˜Ÿä¸æ’åºå·¥å…·</h2>
    
    <div class="main-content">
        <div class="input-area">
            <div class="input-group">
                <h3>ğŸ“ å‚èµ›è€…ä¿¡æ¯è¾“å…¥</h3>
                <div id="participants-list">
                    <div class="participant-row" data-id="1">
                        <input type="text" class="name-input" placeholder="å§“å" value="å¼ ä¸‰">
                        <select class="gender-select">
                            <option value="male">ç”·</option>
                            <option value="female">å¥³</option>
                        </select>
                        <div class="checkbox-group">
                            <label><input type="checkbox" data-format="MD" onchange="checkConflict(this)"> ç”·åŒ (MD)</label>
                            <label><input type="checkbox" data-format="WD" onchange="checkConflict(this)"> å¥³åŒ (WD)</label>
                            <label><input type="checkbox" data-format="XD"> æ··åŒ (XD)</label>
                        </div>
                        <button onclick="removeParticipant(this)">åˆ é™¤</button>
                    </div>
                    <div class="participant-row" data-id="2">
                        <input type="text" class="name-input" placeholder="å§“å" value="æå››">
                        <select class="gender-select">
                            <option value="male">ç”·</option>
                            <option value="female">å¥³</option>
                        </select>
                        <div class="checkbox-group">
                            <label><input type="checkbox" data-format="MD" onchange="checkConflict(this)"> ç”·åŒ (MD)</label>
                            <label><input type="checkbox" data-format="WD" onchange="checkConflict(this)"> å¥³åŒ (WD)</label>
                            <label><input type="checkbox" data-format="XD"> æ··åŒ (XD)</label>
                        </div>
                        <button onclick="removeParticipant(this)">åˆ é™¤</button>
                    </div>
                </div>
                <button class="add-btn" onclick="addParticipant()">+ æ·»åŠ æ–°å‚èµ›è€…</button>
            </div>
        </div>
        
        <div class="output-area">
            
            <div class="column">
                <div class="controls">
                    <button id="draw-btn" onclick="drawTeams()">ğŸŒŸ ç‚¹å‡»æ‘‡å·åˆ†é…é˜Ÿä¼</button>
                </div>
                <div class="result-section">
                    <h3>ğŸ… é˜Ÿä¼åˆ†é…ç»“æœ</h3>
                    <p id="draw-status" style="color: red;"></p>
                    <div id="team-results">
                        <p style="color: #6c757d;">è¯·åœ¨å·¦ä¾§è¾“å…¥å‚èµ›è€…ä¿¡æ¯åï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è¿›è¡Œæ‘‡å·ç»„é˜Ÿã€‚</p>
                    </div>
                </div>
            </div>

            <div class="column">
                <div class="controls">
                    <button id="fixture-btn" onclick="generateFixtures()">âš”ï¸ éšæœºç”Ÿæˆæ¯”èµ›é¡ºåº</button>
                </div>
                <div class="result-section">
                    <h3>ğŸ—“ï¸ æ¯”èµ›é¡ºåº (éšæœºå¯¹é˜µ)</h3>
                    <p id="fixture-status" style="color: red;"></p>
                    <div id="fixture-results">
                        <p style="color: #6c757d;">é˜Ÿä¼æ‘‡å·å®Œæˆåï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ç”Ÿæˆæ¯”èµ›é¡ºåºã€‚</p>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
</div>

<script>
    // --- é…ç½®æ•°æ® (é€»è¾‘éƒ¨åˆ†æœªä¿®æ”¹) ---
    const TEAM_NAMES = [
        "é£ç¾½é˜Ÿ", "é£“é£é˜Ÿ", "é—ªç”µé˜Ÿ", "æµæ˜Ÿé˜Ÿ", "é›„é¹°é˜Ÿ", 
        "ç«ç®­é˜Ÿ", "æš´é£é˜Ÿ", "çŒ›è™é˜Ÿ", "æˆ˜ç‹¼é˜Ÿ", "é»‘é©¬é˜Ÿ",
        "å…ˆé”‹é˜Ÿ", "å…‰é€Ÿé˜Ÿ", "è¶…è¶Šé˜Ÿ", "ç‹è€…é˜Ÿ", "ç»æ€é˜Ÿ"
    ];

    let participantIdCounter = 3;
    let allTeams = {}; // å­˜å‚¨æ‰€æœ‰èµ›åˆ¶çš„é˜Ÿä¼ç»“æœï¼Œæ ¼å¼: { 'MD': [...], 'WD': [...], 'XD': [...] }

    // --- è¾…åŠ©å‡½æ•° ---
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function getRandomTeamName() {
        const index = Math.floor(Math.random() * TEAM_NAMES.length);
        return TEAM_NAMES[index];
    }

    function getParticipantsData() {
        const participants = [];
        const rows = document.querySelectorAll('.participant-row');
        rows.forEach(row => {
            const name = row.querySelector('.name-input').value.trim();
            const gender = row.querySelector('.gender-select').value;
            const formats = [];
            row.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                formats.push(checkbox.getAttribute('data-format'));
            });

            if (name) {
                participants.push({ name, gender, formats });
            }
        });
        return participants;
    }

    // --- ç•Œé¢æ§åˆ¶å‡½æ•° ---
    function checkConflict(checkbox) {
        const row = checkbox.closest('.participant-row');
        const gender = row.querySelector('.gender-select').value;
        const isMale = gender === 'male';
        const isFemale = gender === 'female';
        
        if (checkbox.checked) {
            if (isMale && checkbox.getAttribute('data-format') === 'WD') {
                alert("ç”·æ€§ä¸èƒ½å‚åŠ å¥³åŒï¼è¯·ä¿®æ”¹æ€§åˆ«æˆ–å–æ¶ˆå‹¾é€‰ã€‚");
                checkbox.checked = false;
            } else if (isFemale && checkbox.getAttribute('data-format') === 'MD') {
                alert("å¥³æ€§ä¸èƒ½å‚åŠ ç”·åŒï¼è¯·ä¿®æ”¹æ€§åˆ«æˆ–å–æ¶ˆå‹¾é€‰ã€‚");
                checkbox.checked = false;
            }
        }
    }
    
    function addParticipant() {
        const list = document.getElementById('participants-list');
        const newRow = document.createElement('div');
        newRow.className = 'participant-row';
        newRow.setAttribute('data-id', participantIdCounter++);

        newRow.innerHTML = `
            <input type="text" class="name-input" placeholder="å§“å">
            <select class="gender-select">
                <option value="male">ç”·</option>
                <option value="female">å¥³</option>
            </select>
            <div class="checkbox-group">
                <label><input type="checkbox" data-format="MD" onchange="checkConflict(this)"> ç”·åŒ (MD)</label>
                <label><input type="checkbox" data-format="WD" onchange="checkConflict(this)"> å¥³åŒ (WD)</label>
                <label><input type="checkbox" data-format="XD"> æ··åŒ (XD)</label>
            </div>
            <button onclick="removeParticipant(this)">åˆ é™¤</button>
        `;
        list.appendChild(newRow);
    }

    function removeParticipant(button) {
        const row = button.closest('.participant-row');
        row.remove();
    }

    // --- æ ¸å¿ƒé€»è¾‘å‡½æ•°ï¼šæ‘‡å·åˆ†é…é˜Ÿä¼ ---
    function drawTeams() {
        const participants = getParticipantsData();
        const statusEl = document.getElementById('draw-status');
        const resultsEl = document.getElementById('team-results');
        
        statusEl.textContent = '';
        resultsEl.innerHTML = '';
        allTeams = { 'MD': [], 'WD': [], 'XD': [] };

        if (participants.length < 4) {
            resultsEl.innerHTML = '<p style="color: #6c757d;">è¯·åœ¨å·¦ä¾§è¾“å…¥å‚èµ›è€…ä¿¡æ¯åï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è¿›è¡Œæ‘‡å·ç»„é˜Ÿã€‚</p>';
            statusEl.textContent = 'â— è‡³å°‘éœ€è¦4ä½å‚èµ›è€…æ‰èƒ½ç»„é˜Ÿã€‚';
            return;
        }

        // 1. æŒ‰æ€§åˆ«å’Œèµ›åˆ¶åˆ†ç»„
        const maleMD = participants.filter(p => p.gender === 'male' && p.formats.includes('MD'));
        const maleXD = participants.filter(p => p.gender === 'male' && p.formats.includes('XD'));
        const femaleWD = participants.filter(p => p.gender === 'female' && p.formats.includes('WD'));
        const femaleXD = participants.filter(p => p.gender === 'female' && p.formats.includes('XD'));

        const requiredFormats = [...new Set(participants.flatMap(p => p.formats))];

        // 2. æ ¸å¿ƒç»„é˜Ÿå‡½æ•°
        function createDoubles(pool, format) {
            shuffleArray(pool); // éšæœºæ‰“ä¹±
            const teams = [];
            while (pool.length >= 2) {
                const player1 = pool.pop();
                const player2 = pool.pop();
                teams.push({
                    name: getRandomTeamName() + ` (${format})`,
                    members: [player1.name, player2.name]
                });
            }
            return teams;
        }

        function createMixedDoubles(malePool, femalePool) {
            shuffleArray(malePool);
            shuffleArray(femalePool);
            const teams = [];
            const numTeams = Math.min(malePool.length, femalePool.length);

            for (let i = 0; i < numTeams; i++) {
                const malePlayer = malePool.pop();
                const femalePlayer = femalePool.pop();
                teams.push({
                    name: getRandomTeamName() + ' (XD)',
                    members: [malePlayer.name, femalePlayer.name]
                });
            }
            return teams;
        }

        // 3. æ‰§è¡Œç»„é˜Ÿ
        if (requiredFormats.includes('MD')) {
            allTeams['MD'] = createDoubles([...maleMD], 'MD');
            if (allTeams['MD'].length < 2 && maleMD.length >= 2) {
                 statusEl.textContent += 'âš ï¸ ç”·åŒäººæ•°ä¸ºå•æ•°ï¼Œæœ‰1äººè½®ç©ºã€‚\n';
            } else if (maleMD.length < 4) {
                statusEl.textContent += 'âš ï¸ ç”·åŒï¼ˆMDï¼‰èµ›åˆ¶é˜Ÿä¼å¯èƒ½ä¸è¶³2é˜Ÿã€‚\n';
            }
        }
        
        if (requiredFormats.includes('WD')) {
            allTeams['WD'] = createDoubles([...femaleWD], 'WD');
             if (allTeams['WD'].length < 2 && femaleWD.length >= 2) {
                 statusEl.textContent += 'âš ï¸ å¥³åŒäººæ•°ä¸ºå•æ•°ï¼Œæœ‰1äººè½®ç©ºã€‚\n';
            } else if (femaleWD.length < 4) {
                statusEl.textContent += 'âš ï¸ å¥³åŒï¼ˆWDï¼‰èµ›åˆ¶é˜Ÿä¼å¯èƒ½ä¸è¶³2é˜Ÿã€‚\n';
            }
        }
        
        if (requiredFormats.includes('XD')) {
            allTeams['XD'] = createMixedDoubles([...maleXD], [...femaleXD]);
            if (maleXD.length < 2 || femaleXD.length < 2) {
                statusEl.textContent += 'âš ï¸ æ··åŒï¼ˆXDï¼‰èµ›åˆ¶é˜Ÿä¼å¯èƒ½ä¸è¶³2é˜Ÿã€‚\n';
            }
        }

        // 4. æ˜¾ç¤ºç»“æœ
        let html = '';
        for (const format in allTeams) {
            if (allTeams[format].length > 0) {
                html += `<h4>${format} èµ›åˆ¶ (${allTeams[format].length} æ”¯é˜Ÿä¼)</h4>`;
                html += '<ul class="team-list">';
                allTeams[format].forEach(team => {
                    html += `<li class="team-item"><strong>${team.name}</strong>ï¼š${team.members.join(' & ')}</li>`;
                });
                html += '</ul>';
            }
        }
        
        if (!html) {
             statusEl.textContent = 'â— è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªèµ›åˆ¶ï¼Œå¹¶ç¡®ä¿æœ‰è¶³å¤Ÿäººæ•°å‚èµ›ã€‚';
        } else {
            resultsEl.innerHTML = html;
        }
        
        document.getElementById('fixture-results').innerHTML = '<p style="color: #6c757d;">é˜Ÿä¼æ‘‡å·å®Œæˆåï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ç”Ÿæˆæ¯”èµ›é¡ºåºã€‚</p>'; // æ¸…ç©ºæ¯”èµ›é¡ºåº
        document.getElementById('fixture-status').textContent = '';
    }

    // --- æ ¸å¿ƒé€»è¾‘å‡½æ•°ï¼šéšæœºæ’åºæ¯”èµ› ---
    function generateFixtures() {
        const statusEl = document.getElementById('fixture-status');
        const resultsEl = document.getElementById('fixture-results');
        resultsEl.innerHTML = '';
        statusEl.textContent = '';
        
        if (Object.keys(allTeams).length === 0 || Object.values(allTeams).every(arr => arr.length === 0)) {
            resultsEl.innerHTML = '<p style="color: #6c757d;">é˜Ÿä¼æ‘‡å·å®Œæˆåï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ç”Ÿæˆæ¯”èµ›é¡ºåºã€‚</p>';
            statusEl.textContent = 'â— è¯·å…ˆç‚¹å‡»â€œæ‘‡å·åˆ†é…é˜Ÿä¼â€ç”Ÿæˆé˜Ÿä¼ã€‚';
            return;
        }

        let html = '';
        let totalFixtureCount = 0;

        for (const format in allTeams) {
            const teams = allTeams[format];
            if (teams.length >= 2) {
                // 1. åˆ›å»ºå¯¹é˜µåˆ—è¡¨
                const fixtures = [];
                const shuffledTeams = [...teams];
                shuffleArray(shuffledTeams);

                // 2. ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å¯¹é˜µç»„åˆ
                for (let i = 0; i < shuffledTeams.length; i++) {
                    for (let j = i + 1; j < shuffledTeams.length; j++) {
                        fixtures.push([shuffledTeams[i].name, shuffledTeams[j].name]);
                    }
                }
                
                // 3. éšæœºæ‰“ä¹±å¯¹é˜µé¡ºåº
                shuffleArray(fixtures);
                
                // 4. æ˜¾ç¤ºå¯¹é˜µç»“æœ
                html += `<h4>âš”ï¸ ${format} èµ›åˆ¶ æ¯”èµ›é¡ºåº (${fixtures.length} åœº)</h4>`;
                let fixtureHtml = '<ol>';
                fixtures.forEach((pair, index) => {
                    totalFixtureCount++;
                    fixtureHtml += `<li class="fixture-item"><span>ç¬¬ ${index + 1} åœº</span><span><strong>${pair[0].split('(')[0].trim()}</strong> VS <strong>${pair[1].split('(')[0].trim()}</strong></span></li>`;
                });
                fixtureHtml += '</ol>';
                html += fixtureHtml;
            } else if (teams.length > 0) {
                html += `<h4>âš”ï¸ ${format} èµ›åˆ¶</h4><p style="color: red;">é˜Ÿä¼æ•°é‡ä¸è¶³2æ”¯ï¼Œæ— æ³•ç”Ÿæˆæ¯”èµ›å¯¹é˜µã€‚</p>`;
            }
        }
        
        if (totalFixtureCount > 0) {
            resultsEl.innerHTML = html;
        } else {
            statusEl.textContent = 'â— æ‰€æœ‰èµ›åˆ¶é˜Ÿä¼æ•°é‡å‡ä¸è¶³2æ”¯ï¼Œæ— æ³•ç”Ÿæˆå¯¹é˜µã€‚';
        }
    }
</script>
</body>
</html>
